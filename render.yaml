services:
  # -------------------------------
  # RabbitMQ (Private Service)
  # -------------------------------
  - name: rabbitmq
    type: private-service
    env: docker
    plan: starter
    dockerfilePath: ./rabbitmq.Dockerfile
    autoDeploy: true

  # -------------------------------
  # Consul (Private Service)
  # -------------------------------
  - name: consul
    type: private-service
    env: docker
    plan: starter
    dockerfilePath: ./consul.Dockerfile

  # -------------------------------
  # Escrow Service
  # -------------------------------
  - name: escrow-service
    type: web
    env: docker
    dockerfilePath: Backend/Escrow-service/Dockerfile
    plan: starter
    envVars:
      - key: DB_HOST
        value: ${ESCROW_DB_HOST}
      - key: DB_PORT
        value: "5432"
      - key: DB_USER
        value: postgres
      - key: DB_PASSWORD
        sync: false
      - key: DB_NAME
        value: escrowdb
      - key: RABBITMQ_URL
        value: http://rabbitmq:5672
      - key: CONSUL_HOST
        value: http://consul:8500
      - key: AI_ARBITRATOR_HOST
        value: ai-arbitrator-service
      - key: AI_ARBITRATOR_PORT
        value: "50055"

  # -------------------------------
  # Chat Service
  # -------------------------------
  - name: chat-service
    type: web
    env: docker
    plan: starter
    dockerfilePath: Backend/Chat-service/Dockerfile
    envVars:
      - key: DB_HOST
        value: ${CHAT_DB_HOST}
      - key: DB_PORT
        value: "5432"
      - key: DB_USER
        value: postgres
      - key: DB_PASSWORD
        sync: false

  # -------------------------------
  # Payment Service
  # -------------------------------
  - name: payment-service
    type: web
    env: docker
    plan: starter
    dockerfilePath: Backend/Payment-service/Dockerfile
    envVars:
      - key: DB_HOST
        value: ${PAYMENT_DB_HOST}
      - key: DB_USER
        value: postgres
      - key: DB_PORT
        value: "5432"
      - key: DB_PASSWORD
        sync: false

  # -------------------------------
  # User Service
  # -------------------------------
  - name: user-service
    type: web
    env: docker
    plan: starter
    dockerfilePath: Backend/User-service/Dockerfile
    envVars:
      - key: DB_HOST
        value: ${USER_DB_HOST}
      - key: DB_PORT
        value: "5432"
      - key: DB_USER
        value: postgres
      - key: DB_PASSWORD
        sync: false
      - key: REDIS_HOST
        value: ${REDIS_HOST}
      - key: REDIS_PORT
        value: "6379"

  # -------------------------------
  # API Gateway
  # -------------------------------
  - name: api-gateway
    type: web
    env: docker
    plan: starter
    dockerfilePath: Backend/Api-gateway/Dockerfile
    envVars:
      - key: CONSUL_HOST
        value: http://consul:8500

  # -------------------------------
  # AI Arbitrator Service
  # -------------------------------
  - name: ai-arbitrator-service
    type: private-service
    env: docker
    plan: starter
    dockerfilePath: Backend/ai-service/dockerfile
    envVars:
      - key: GEMINI_API_KEY
        sync: false

# -------------------------------
# Databases (Render managed)
# -------------------------------

databases:
  - name: user-db
    plan: starter
  - name: escrow-db
    plan: starter
  - name: payment-db
    plan: starter
  - name: chat-db
    plan: starter

# -------------------------------
# Redis (Render managed)
# -------------------------------
redis:
  - name: redis-auth
    plan: starter
